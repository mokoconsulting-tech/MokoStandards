# Copyright (C) 2026 Moko Consulting <hello@mokoconsulting.tech>
# SPDX-License-Identifier: GPL-3.0-or-later
# FILE INFORMATION
# DEFGROUP: GitHub.Workflow
# INGROUP: MokoStandards.Compliance
# REPO: https://github.com/mokoconsulting-tech/MokoStandards
# PATH: /.github/workflows/standards-compliance.yml
# VERSION: 04.00.00
# BRIEF: MokoStandards compliance validation workflow
# NOTE: Validates repository structure, documentation, and coding standards

name: Standards Compliance

env:
  ACTIONS_STEP_DEBUG: true
  ACTIONS_RUNNER_DEBUG: true
  WORKFLOW_VERSION: "04.00.00"

# MokoStandards Policy Compliance:
# - File formatting: Enforces organizational coding standards
# - Reference: docs/policy/file-formatting.md

# ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
# ‚îÇ                         WORKFLOW FLOW DIAGRAM                            ‚îÇ
# ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#
#   TRIGGER: Push/PR to main/dev/rc branches
#        ‚îÇ
#        ‚ñº
#   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
#   ‚îÇ              PARALLEL VALIDATION CHECKS                      ‚îÇ
#   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#        ‚îÇ
#        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
#        ‚ñº             ‚ñº              ‚ñº              ‚ñº            ‚ñº
#   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
#   ‚îÇRepository  ‚îÇFile Header  ‚îÇCode Style‚îÇ  ‚îÇ  Docs   ‚îÇ  ‚îÇ License  ‚îÇ
#   ‚îÇStructure‚îÇ  ‚îÇ Validation‚îÇ  ‚îÇ  Check   ‚îÇ  ‚îÇ  Check  ‚îÇ  ‚îÇ  Check   ‚îÇ
#   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#        ‚îÇ             ‚îÇ              ‚îÇ              ‚îÇ            ‚îÇ
#        ‚ñº             ‚ñº              ‚ñº              ‚ñº            ‚ñº
#   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
#   ‚îÇ  Check  ‚îÇ  ‚îÇ  Verify  ‚îÇ  ‚îÇ   Run    ‚îÇ  ‚îÇ  Check  ‚îÇ  ‚îÇ  Verify  ‚îÇ
#   ‚îÇRequired ‚îÇ  ‚îÇCopyright ‚îÇ  ‚îÇ Linters  ‚îÇ  ‚îÇREADME   ‚îÇ  ‚îÇSPDX-ID   ‚îÇ
#   ‚îÇ  Dirs   ‚îÇ  ‚îÇ  Header  ‚îÇ  ‚îÇ(Python,  ‚îÇ  ‚îÇ  Exists ‚îÇ  ‚îÇ Present  ‚îÇ
#   ‚îÇ         ‚îÇ  ‚îÇ  Format  ‚îÇ  ‚îÇPHP,YAML) ‚îÇ  ‚îÇ         ‚îÇ  ‚îÇ          ‚îÇ
#   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#        ‚îÇ             ‚îÇ              ‚îÇ              ‚îÇ            ‚îÇ
#        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#                                     ‚îÇ
#                                     ‚ñº
#                           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
#                           ‚îÇ  All Checks Pass?‚îÇ
#                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#                              ‚îÇ            ‚îÇ
#                          YES ‚îÇ            ‚îÇ NO
#                              ‚ñº            ‚ñº
#                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
#                       ‚îÇ  SUCCESS ‚îÇ  ‚îÇ CREATE ISSUE ‚îÇ
#                       ‚îÇ  Summary ‚îÇ  ‚îÇ with Failure ‚îÇ
#                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   Details    ‚îÇ
#                                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

on:
  push:
    branches:
      - main
      - dev/**
      - rc/**
  pull_request:
    branches:
      - main
      - dev/**
      - rc/**
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write

jobs:
  repository-structure:
    name: Repository Structure Validation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v6

      - name: Check Required Directories
        run: |
          set -x
          echo "## üìÅ Repository Structure Validation" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          MISSING=0
          PRESENT=0
          TOTAL=3

          echo "### Required Directories" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Directory | Status | Files | Size | Notes |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|--------|-------|------|-------|" >> $GITHUB_STEP_SUMMARY

          # Check required directories
          for dir in docs scripts .github; do
            if [ -d "$dir" ]; then
              FILE_COUNT=$(find "$dir" -type f 2>/dev/null | wc -l)
              DIR_SIZE=$(du -sh "$dir" 2>/dev/null | cut -f1)
              echo "| $dir/ | ‚úÖ Pass | $FILE_COUNT files | $DIR_SIZE | Complete |" >> $GITHUB_STEP_SUMMARY
              PRESENT=$((PRESENT + 1))
            else
              echo "| $dir/ | ‚ùå **Missing** | - | - | **Action Required** |" >> $GITHUB_STEP_SUMMARY
              MISSING=$((MISSING + 1))
            fi
          done

          echo "" >> $GITHUB_STEP_SUMMARY
          PERCENT=$((PRESENT * 100 / TOTAL))
          echo "**Compliance Score:** $PERCENT% ($PRESENT/$TOTAL directories present)" >> $GITHUB_STEP_SUMMARY

          if [ "$MISSING" -gt 0 ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### üî¥ Critical Issues: $MISSING" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Remediation Steps:**" >> $GITHUB_STEP_SUMMARY
            [ ! -d "docs" ] && echo "- Create docs directory: \`mkdir docs && echo '# Documentation' > docs/README.md\`" >> $GITHUB_STEP_SUMMARY
            [ ! -d "scripts" ] && echo "- Create scripts directory: \`mkdir scripts && touch scripts/.gitkeep\`" >> $GITHUB_STEP_SUMMARY
            [ ! -d ".github" ] && echo "- Create .github directory: \`mkdir -p .github/workflows\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "üìö Reference: [MokoStandards Repository Structure](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/docs/policy/core-structure.md)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ùå Validation Failed: Required Directories Missing" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Status:** Repository structure does not meet MokoStandards requirements" >> $GITHUB_STEP_SUMMARY
            echo "**Missing:** $MISSING required director(y|ies)" >> $GITHUB_STEP_SUMMARY
            echo "**Compliance:** $PERCENT% ($PRESENT/$TOTAL directories present)" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ùå ERROR: Required directories missing - See job summary for remediation steps"
            exit 1
          fi

      - name: Check Required Files
        run: |
          set -x
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Required Files" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          MISSING=0
          PRESENT=0
          TOTAL=6

          echo "| File | Status | Size | Last Modified | Notes |" >> $GITHUB_STEP_SUMMARY
          echo "|------|--------|------|---------------|-------|" >> $GITHUB_STEP_SUMMARY

          # Check required files
          for file in README.md LICENSE CONTRIBUTING.md SECURITY.md CHANGELOG.md .editorconfig; do
            if [ -f "$file" ]; then
              FILE_SIZE=$(wc -c < "$file" 2>/dev/null | awk '{printf "%.1f KB", $1/1024}')
              LAST_MOD=$(stat -c %y "$file" 2>/dev/null | cut -d' ' -f1 || echo "Unknown")
              CONTENT_CHECK=""

              # Basic content validation
              case "$file" in
                "README.md")
                  LINES=$(wc -l < "$file")
                  [ "$LINES" -lt 10 ] && CONTENT_CHECK="‚ö†Ô∏è Too short"
                  ;;
                "LICENSE")
                  [ $(wc -c < "$file") -lt 100 ] && CONTENT_CHECK="‚ö†Ô∏è Incomplete?"
                  ;;
              esac

              echo "| $file | ‚úÖ Pass | $FILE_SIZE | $LAST_MOD | Complete $CONTENT_CHECK |" >> $GITHUB_STEP_SUMMARY
              PRESENT=$((PRESENT + 1))
            else
              echo "| $file | ‚ùå **Missing** | - | - | **Required** |" >> $GITHUB_STEP_SUMMARY
              MISSING=$((MISSING + 1))
            fi
          done

          echo "" >> $GITHUB_STEP_SUMMARY
          PERCENT=$((PRESENT * 100 / TOTAL))
          echo "**Compliance Score:** $PERCENT% ($PRESENT/$TOTAL files present)" >> $GITHUB_STEP_SUMMARY

          if [ "$MISSING" -gt 0 ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### üî¥ Critical Issues: $MISSING" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Remediation Steps:**" >> $GITHUB_STEP_SUMMARY
            [ ! -f "README.md" ] && echo "- Create README.md: Use [template](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/templates/docs/required/README.md)" >> $GITHUB_STEP_SUMMARY
            [ ! -f "LICENSE" ] && echo "- Add LICENSE file: Choose from [OSI-approved licenses](https://opensource.org/licenses)" >> $GITHUB_STEP_SUMMARY
            [ ! -f "CONTRIBUTING.md" ] && echo "- Create CONTRIBUTING.md: Use [template](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/templates/docs/required/CONTRIBUTING.md)" >> $GITHUB_STEP_SUMMARY
            [ ! -f "SECURITY.md" ] && echo "- Create SECURITY.md: Use [template](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/templates/docs/required/SECURITY.md)" >> $GITHUB_STEP_SUMMARY
            [ ! -f "CHANGELOG.md" ] && echo "- Create CHANGELOG.md: Follow [Keep a Changelog](https://keepachangelog.com/)" >> $GITHUB_STEP_SUMMARY
            [ ! -f ".editorconfig" ] && echo "- Add .editorconfig: Use [template](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/templates/.editorconfig)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "üìö Reference: [MokoStandards File Requirements](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/docs/policy/file-header-standards.md)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ùå Validation Failed: Required Files Missing" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Status:** Repository files do not meet MokoStandards requirements" >> $GITHUB_STEP_SUMMARY
            echo "**Missing:** $MISSING required file(s)" >> $GITHUB_STEP_SUMMARY
            echo "**Compliance:** $PERCENT% ($PRESENT/$TOTAL files present)" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ùå ERROR: Required files missing - See job summary for remediation steps"
            exit 1
          fi

  documentation-quality:
    name: Documentation Quality Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v6

      - name: Validate README.md
        run: |
          set -x
          echo "## üìö Documentation Quality Check" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### README.md Analysis" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ ! -f "README.md" ]; then
            echo "‚ùå **Critical:** README.md not found" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ùå Validation Failed: README.md Missing" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Error:** README.md is required for all MokoStandards-compliant repositories" >> $GITHUB_STEP_SUMMARY
            echo "**Action Required:** Create README.md with project description, setup instructions, and usage examples" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ùå ERROR: README.md not found - This is a critical requirement"
            exit 1
          fi

          # Detailed content analysis
          SIZE=$(wc -c < README.md)
          LINES=$(wc -l < README.md)
          WORDS=$(wc -w < README.md)
          HEADINGS=$(grep -c "^#" README.md || echo 0)
          LINKS=$(grep -c "\[.*\](.*)" README.md || echo 0)
          CODE_BLOCKS=$(grep -c '```' README.md || echo 0)

          echo "| Metric | Value | Status | Recommendation |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|-------|--------|----------------|" >> $GITHUB_STEP_SUMMARY

          # Size check
          SIZE_STATUS="‚úÖ Good"
          SIZE_REC="Adequate length"
          if [ "$SIZE" -lt 500 ]; then
            SIZE_STATUS="‚ö†Ô∏è Warning"
            SIZE_REC="Add more content (min 500 bytes)"
          elif [ "$SIZE" -gt 50000 ]; then
            SIZE_STATUS="‚ö†Ô∏è Warning"
            SIZE_REC="Consider splitting into multiple docs"
          fi
          echo "| Size | $SIZE bytes | $SIZE_STATUS | $SIZE_REC |" >> $GITHUB_STEP_SUMMARY

          # Line count
          LINES_STATUS="‚úÖ Good"
          LINES_REC="Good size"
          if [ "$LINES" -lt 20 ]; then
            LINES_STATUS="‚ö†Ô∏è Warning"
            LINES_REC="Add more sections (min 20 lines)"
          fi
          echo "| Lines | $LINES | $LINES_STATUS | $LINES_REC |" >> $GITHUB_STEP_SUMMARY

          # Word count
          WORDS_STATUS="‚úÖ Good"
          WORDS_REC="Good detail"
          if [ "$WORDS" -lt 100 ]; then
            WORDS_STATUS="‚ö†Ô∏è Warning"
            WORDS_REC="Add more description (min 100 words)"
          fi
          echo "| Words | $WORDS | $WORDS_STATUS | $WORDS_REC |" >> $GITHUB_STEP_SUMMARY

          # Headings
          HEADINGS_STATUS="‚úÖ Good"
          HEADINGS_REC="Well structured"
          if [ "$HEADINGS" -lt 3 ]; then
            HEADINGS_STATUS="‚ö†Ô∏è Warning"
            HEADINGS_REC="Add more sections (min 3 headings)"
          fi
          echo "| Headings | $HEADINGS | $HEADINGS_STATUS | $HEADINGS_REC |" >> $GITHUB_STEP_SUMMARY

          # Links
          LINKS_STATUS="‚úÖ Good"
          LINKS_REC="Includes references"
          if [ "$LINKS" -lt 1 ]; then
            LINKS_STATUS="‚ÑπÔ∏è Info"
            LINKS_REC="Consider adding useful links"
          fi
          echo "| Links | $LINKS | $LINKS_STATUS | $LINKS_REC |" >> $GITHUB_STEP_SUMMARY

          # Code blocks
          CODE_STATUS="‚úÖ Good"
          CODE_REC="Includes examples"
          if [ "$CODE_BLOCKS" -eq 0 ]; then
            CODE_STATUS="‚ÑπÔ∏è Info"
            CODE_REC="Consider adding code examples"
          fi
          echo "| Code blocks | $CODE_BLOCKS | $CODE_STATUS | $CODE_REC |" >> $GITHUB_STEP_SUMMARY

          echo "" >> $GITHUB_STEP_SUMMARY

          # Check for key sections
          echo "**Section Coverage:**" >> $GITHUB_STEP_SUMMARY
          MISSING_COUNT=0
          grep -qi "install\|setup\|getting started" README.md && echo "- ‚úÖ Installation/Setup instructions" >> $GITHUB_STEP_SUMMARY || { echo "- ‚ö†Ô∏è Missing: Installation/Setup" >> $GITHUB_STEP_SUMMARY; MISSING_COUNT=$((MISSING_COUNT + 1)); }
          grep -qi "usage\|example\|how to" README.md && echo "- ‚úÖ Usage examples" >> $GITHUB_STEP_SUMMARY || { echo "- ‚ö†Ô∏è Missing: Usage examples" >> $GITHUB_STEP_SUMMARY; MISSING_COUNT=$((MISSING_COUNT + 1)); }
          grep -qi "license" README.md && echo "- ‚úÖ License information" >> $GITHUB_STEP_SUMMARY || { echo "- ‚ö†Ô∏è Missing: License information" >> $GITHUB_STEP_SUMMARY; MISSING_COUNT=$((MISSING_COUNT + 1)); }
          grep -qi "contribut" README.md && echo "- ‚úÖ Contributing guidelines" >> $GITHUB_STEP_SUMMARY || echo "- ‚ÑπÔ∏è Optional: Contributing section" >> $GITHUB_STEP_SUMMARY

          if [ "$MISSING_COUNT" -gt 0 ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**‚ö†Ô∏è $MISSING_COUNT important sections missing**" >> $GITHUB_STEP_SUMMARY
          fi

      - name: Validate CHANGELOG.md
        run: |
          set -x
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### CHANGELOG.md Analysis" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ ! -f "CHANGELOG.md" ]; then
            echo "‚ùå **Critical:** CHANGELOG.md not found" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ùå Validation Failed: CHANGELOG.md Missing" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Error:** CHANGELOG.md is required for all MokoStandards-compliant repositories" >> $GITHUB_STEP_SUMMARY
            echo "**Action Required:** Create CHANGELOG.md following [Keep a Changelog](https://keepachangelog.com/) format" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ùå ERROR: CHANGELOG.md not found - This is a critical requirement"
            exit 1
          fi

          # Analyze changelog structure
          VERSIONS=$(grep -c "## \[" CHANGELOG.md || echo 0)
          UNRELEASED=$(grep -c "## \[Unreleased\]" CHANGELOG.md || echo 0)
          DATES=$(grep -c "[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}" CHANGELOG.md || echo 0)
          SIZE=$(wc -c < CHANGELOG.md)

          echo "| Metric | Value | Status | Notes |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|-------|--------|-------|" >> $GITHUB_STEP_SUMMARY

          # Check format
          if grep -qi "## \[.*\]" CHANGELOG.md; then
            echo "| Format | Keep a Changelog | ‚úÖ Pass | Standard format |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| Format | Custom | ‚ö†Ô∏è Warning | Consider [Keep a Changelog](https://keepachangelog.com/) |" >> $GITHUB_STEP_SUMMARY
          fi

          # Version count
          VERSIONS_STATUS="‚úÖ Good"
          VERSIONS_NOTE="Well maintained"
          if [ "$VERSIONS" -lt 1 ]; then
            VERSIONS_STATUS="‚ö†Ô∏è Warning"
            VERSIONS_NOTE="Add version entries"
          fi
          echo "| Versions | $VERSIONS | $VERSIONS_STATUS | $VERSIONS_NOTE |" >> $GITHUB_STEP_SUMMARY

          # Unreleased section
          if [ "$UNRELEASED" -gt 0 ]; then
            echo "| Unreleased | Yes | ‚úÖ Good | Active development tracked |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| Unreleased | No | ‚ÑπÔ∏è Info | Consider adding [Unreleased] section |" >> $GITHUB_STEP_SUMMARY
          fi

          # Dates
          DATES_STATUS="‚úÖ Good"
          if [ "$DATES" -lt 1 ]; then
            DATES_STATUS="‚ö†Ô∏è Warning"
            DATES_NOTE="Add release dates"
          else
            DATES_NOTE="Dates present"
          fi
          echo "| Release dates | $DATES | $DATES_STATUS | $DATES_NOTE |" >> $GITHUB_STEP_SUMMARY

          # Check for standard sections
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Changelog Sections:**" >> $GITHUB_STEP_SUMMARY
          grep -qi "### Added" CHANGELOG.md && echo "- ‚úÖ Added section" >> $GITHUB_STEP_SUMMARY || echo "- ‚ÑπÔ∏è Added section (optional)" >> $GITHUB_STEP_SUMMARY
          grep -qi "### Changed" CHANGELOG.md && echo "- ‚úÖ Changed section" >> $GITHUB_STEP_SUMMARY || echo "- ‚ÑπÔ∏è Changed section (optional)" >> $GITHUB_STEP_SUMMARY
          grep -qi "### Fixed" CHANGELOG.md && echo "- ‚úÖ Fixed section" >> $GITHUB_STEP_SUMMARY || echo "- ‚ÑπÔ∏è Fixed section (optional)" >> $GITHUB_STEP_SUMMARY

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "üìö Reference: [Keep a Changelog](https://keepachangelog.com/)" >> $GITHUB_STEP_SUMMARY

      - name: Check Documentation Index
        run: |
          set -x
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Documentation Index" >> $GITHUB_STEP_SUMMARY

          if [ -f "docs/index.md" ] || [ -f "docs/README.md" ]; then
            echo "‚úÖ Documentation index found" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚ö†Ô∏è No documentation index (docs/index.md or docs/README.md)" >> $GITHUB_STEP_SUMMARY
          fi

  coding-standards:
    name: Coding Standards Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v6

      - name: Check for Tab Characters
        run: |
          set -x
          echo "### Tab Character Detection" >> $GITHUB_STEP_SUMMARY

          # Policy: Tabs are DEFAULT. Only check for tabs in files that REQUIRE spaces.
          # Languages requiring spaces: YAML, Python, Haskell, F#, CoffeeScript, Nim, JSON, RST
          TABS_IN_SPACES_FILES=$(find . -type f \
            \( -name "*.yml" -o -name "*.yaml" \
            -o -name "*.py" \
            -o -name "*.hs" -o -name "*.lhs" \
            -o -name "*.fs" -o -name "*.fsx" -o -name "*.fsi" \
            -o -name "*.coffee" -o -name "*.litcoffee" \
            -o -name "*.nim" -o -name "*.nims" -o -name "*.nimble" \
            -o -name "*.json" \
            -o -name "*.rst" \) \
            ! -path "./vendor/*" \
            ! -path "./node_modules/*" \
            ! -path "./.git/*" \
            -exec grep -l $'\t' {} \; 2>/dev/null | head -10)

          if [ -n "$TABS_IN_SPACES_FILES" ]; then
            echo "‚ö†Ô∏è Tab characters found in files that require spaces:" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "$TABS_IN_SPACES_FILES" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "These languages require spaces (tabs will break): YAML, Python, Haskell, F#, CoffeeScript, Nim, JSON, RST" >> $GITHUB_STEP_SUMMARY
            echo "All other files (including .md, .ps1, LICENSE, etc.) may use tabs per MokoStandards policy" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚úÖ No tabs found in files requiring spaces" >> $GITHUB_STEP_SUMMARY
            echo "Note: Tabs are allowed in most files (policy default). Only checked files requiring spaces." >> $GITHUB_STEP_SUMMARY
          fi

      - name: Check File Encoding
        run: |
          set -x
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### File Encoding Check" >> $GITHUB_STEP_SUMMARY

          # Check for UTF-8 encoding (ASCII is a subset of UTF-8 and is acceptable)
          NON_UTF8=$(find . -type f \( -name "*.php" -o -name "*.js" -o -name "*.md" \) \
            ! -path "./vendor/*" \
            ! -path "./node_modules/*" \
            ! -path "./.git/*" \
            -exec file {} \; | grep -v "UTF-8" | grep -v "ASCII" | head -5)

          if [ -n "$NON_UTF8" ]; then
            echo "‚ö†Ô∏è Non-UTF-8 files detected:" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "$NON_UTF8" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚úÖ All source files appear to be UTF-8 encoded" >> $GITHUB_STEP_SUMMARY
          fi

      - name: Check Line Endings
        run: |
          set -x
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Line Ending Check" >> $GITHUB_STEP_SUMMARY

          # Check for CRLF line endings
          CRLF_FILES=$(find . -type f \( -name "*.php" -o -name "*.js" -o -name "*.md" \) \
            ! -path "./vendor/*" \
            ! -path "./node_modules/*" \
            ! -path "./.git/*" \
            -exec file {} \; | grep "CRLF" | head -5)

          if [ -n "$CRLF_FILES" ]; then
            echo "‚ö†Ô∏è Files with CRLF line endings found:" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "$CRLF_FILES" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "MokoStandards requires LF line endings" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚úÖ Line endings are consistent (LF)" >> $GITHUB_STEP_SUMMARY
          fi

  license-compliance:
    name: License Header Validation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v6

      - name: Check SPDX Headers
        run: |
          set -x
          echo "### SPDX License Header Check" >> $GITHUB_STEP_SUMMARY

          # Count source files with and without SPDX headers
          TOTAL_PHP=0
          WITH_SPDX_PHP=0

          if find . -name "*.php" -type f ! -path "./vendor/*" | head -1 | grep -q .; then
            TOTAL_PHP=$(find . -name "*.php" -type f ! -path "./vendor/*" | wc -l)
            WITH_SPDX_PHP=$(find . -name "*.php" -type f ! -path "./vendor/*" -exec grep -l "SPDX-License-Identifier" {} \; | wc -l)
          fi

          if [ "$TOTAL_PHP" -gt 0 ]; then
            PERCENT=$((WITH_SPDX_PHP * 100 / TOTAL_PHP))
            echo "- PHP files: $WITH_SPDX_PHP/$TOTAL_PHP ($PERCENT%) with SPDX headers" >> $GITHUB_STEP_SUMMARY

            if [ "$PERCENT" -lt 80 ]; then
              echo "‚ö†Ô∏è Less than 80% of PHP files have SPDX headers" >> $GITHUB_STEP_SUMMARY
            else
              echo "‚úÖ Good SPDX header coverage" >> $GITHUB_STEP_SUMMARY
            fi
          fi

      - name: Validate License File
        run: |
          set -x
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### License File Validation" >> $GITHUB_STEP_SUMMARY

          if [ ! -f "LICENSE" ]; then
            echo "‚ùå LICENSE file not found" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ùå Validation Failed: LICENSE File Missing" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Error:** LICENSE file is required for all MokoStandards-compliant repositories" >> $GITHUB_STEP_SUMMARY
            echo "**Action Required:** Add LICENSE file with appropriate open-source license (GPL-3.0-or-later recommended)" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ùå ERROR: LICENSE file not found - This is a critical requirement"
            exit 1
          fi

          # Check license type
          if grep -qi "GNU GENERAL PUBLIC LICENSE" LICENSE; then
            VERSION=$(grep -i "Version 3" LICENSE || echo "")
            if [ -n "$VERSION" ]; then
              echo "‚úÖ GPL-3.0-or-later license detected" >> $GITHUB_STEP_SUMMARY
            else
              echo "‚ö†Ô∏è GPL license detected but version unclear" >> $GITHUB_STEP_SUMMARY
            fi
          elif grep -qi "MIT License" LICENSE; then
            echo "‚úÖ MIT license detected" >> $GITHUB_STEP_SUMMARY
          elif grep -qi "Apache License" LICENSE; then
            echo "‚úÖ Apache license detected" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚ÑπÔ∏è License type could not be automatically detected" >> $GITHUB_STEP_SUMMARY
          fi

  git-hygiene:
    name: Git Repository Hygiene
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Check .gitignore
        run: |
          set -x
          echo "### .gitignore Validation" >> $GITHUB_STEP_SUMMARY

          if [ ! -f ".gitignore" ]; then
            echo "‚ö†Ô∏è .gitignore file not found" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ö†Ô∏è Warning: .gitignore Not Found" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Status:** .gitignore file is recommended but not required" >> $GITHUB_STEP_SUMMARY
            echo "**Recommendation:** Add .gitignore to exclude build artifacts, dependencies, and temporary files" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ö†Ô∏è WARNING: .gitignore file not found - Continuing validation"
            exit 0
          fi

          # Check for common exclusions
          MISSING=""
          grep -q "vendor/" .gitignore || MISSING="${MISSING}vendor/ "
          grep -q "node_modules/" .gitignore || MISSING="${MISSING}node_modules/ "

          if [ -n "$MISSING" ]; then
            echo "‚ö†Ô∏è .gitignore may be missing common exclusions: $MISSING" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚úÖ .gitignore appears complete" >> $GITHUB_STEP_SUMMARY
          fi

      - name: Check for Large Files
        run: |
          set -x
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Large File Detection" >> $GITHUB_STEP_SUMMARY

          # Find files larger than 1MB
          LARGE_FILES=$(find . -type f -size +1M ! -path "./.git/*" ! -path "./vendor/*" ! -path "./node_modules/*" | head -5)

          if [ -n "$LARGE_FILES" ]; then
            echo "‚ö†Ô∏è Large files detected (>1MB):" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "$LARGE_FILES" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "Consider using Git LFS for large binary files" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚úÖ No unusually large files detected" >> $GITHUB_STEP_SUMMARY
          fi

  workflow-validation:
    name: Workflow Configuration Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v6

      - name: Check Required Workflows
        run: |
          set -x
          echo "### GitHub Actions Workflows" >> $GITHUB_STEP_SUMMARY

          WORKFLOWS_DIR=".github/workflows"

          if [ ! -d "$WORKFLOWS_DIR" ]; then
            echo "‚ùå No workflows directory found" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ùå Validation Failed: Workflows Directory Missing" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Error:** .github/workflows directory is required for CI/CD automation" >> $GITHUB_STEP_SUMMARY
            echo "**Action Required:** Create .github/workflows directory and add GitHub Actions workflows" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ùå ERROR: .github/workflows directory not found"
            exit 1
          fi

          # Check for recommended workflows
          if [ -f "$WORKFLOWS_DIR/ci.yml" ] || [ -f "$WORKFLOWS_DIR/build.yml" ]; then
            echo "‚úÖ CI workflow present" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚ö†Ô∏è No CI workflow found (ci.yml or build.yml)" >> $GITHUB_STEP_SUMMARY
          fi

          if [ -f "$WORKFLOWS_DIR/codeql-analysis.yml" ]; then
            echo "‚úÖ CodeQL security scanning present" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚ö†Ô∏è CodeQL workflow not found" >> $GITHUB_STEP_SUMMARY
          fi

      - name: Validate Workflow Syntax
        run: |
          set -x
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Workflow YAML Syntax" >> $GITHUB_STEP_SUMMARY

          # Check if .yamllint override file exists
          if [ -f ".yamllint" ]; then
            echo "‚ÑπÔ∏è Using .yamllint configuration file" >> $GITHUB_STEP_SUMMARY
            YAMLLINT_CONFIG="-c .yamllint"
          else
            echo "‚ÑπÔ∏è Using default yamllint configuration" >> $GITHUB_STEP_SUMMARY
            YAMLLINT_CONFIG=""
          fi

          INVALID=0
          for workflow in $(find .github/workflows -maxdepth 1 -type f \( -name "*.yml" -o -name "*.yaml" \) 2>/dev/null); do
            if [ -f "$workflow" ]; then
              if yamllint $YAMLLINT_CONFIG "$workflow" >/dev/null 2>&1; then
                echo "‚úÖ $(basename $workflow)" >> $GITHUB_STEP_SUMMARY
              else
                echo "‚ùå $(basename $workflow) - invalid YAML" >> $GITHUB_STEP_SUMMARY
                INVALID=$((INVALID + 1))
              fi
            fi
          done

          if [ "$INVALID" -gt 0 ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ùå Validation Failed: Invalid Workflow YAML Syntax" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Error:** $INVALID workflow file(s) have invalid YAML syntax" >> $GITHUB_STEP_SUMMARY
            echo "**Action Required:** Fix YAML syntax errors in the marked workflow files" >> $GITHUB_STEP_SUMMARY
            echo "**Tool:** Run \`yamllint .github/workflows/\` locally to identify issues" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ùå ERROR: $INVALID workflow file(s) with invalid YAML syntax"
            exit 1
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ‚úÖ All Workflow Files Have Valid YAML Syntax" >> $GITHUB_STEP_SUMMARY
          echo ""
          echo "‚úÖ SUCCESS: All workflow files passed YAML validation"

      - name: Validate CodeQL Configuration
        if: hashFiles('.github/workflows/codeql-analysis.yml') != ''
        run: |
          set -e
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### CodeQL Language Configuration" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Inline validation (rewritten from Python to bash for PHP-only architecture)
          CODEQL_FILE=".github/workflows/codeql-analysis.yml"

          if [ ! -f "$CODEQL_FILE" ]; then
            echo "‚ö†Ô∏è CodeQL workflow file not found" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ö†Ô∏è CodeQL Workflow Not Found" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Status:** CodeQL workflow file not present - skipping language validation" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ö†Ô∏è INFO: CodeQL workflow not found - Skipping validation"
            exit 0
          fi

          echo "**CodeQL Configuration Analysis**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Extract configured languages from workflow
          LANGUAGES=$(grep -A5 "language:" "$CODEQL_FILE" | grep -oP "(?<=')[^']+(?=')" | tr '\n' ' ' || echo "")

          # Check if this is a configuration-only scan (no languages specified)
          if grep -q "category.*language:config" "$CODEQL_FILE"; then
            echo "**Scan Type:** Configuration-only (no language matrix)" >> $GITHUB_STEP_SUMMARY
            echo "**Status:** ‚úÖ Valid configuration for PHP-only repository" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "This CodeQL workflow scans YAML, JSON, shell scripts for security issues." >> $GITHUB_STEP_SUMMARY
            echo "PHP security is handled by SecurityValidator enterprise library." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "‚úÖ SUCCESS: CodeQL configuration-only scan properly configured"
            exit 0
          fi

          if [ -z "$LANGUAGES" ]; then
            echo "‚ùå No languages configured in CodeQL workflow" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ùå Validation Failed: CodeQL Languages Not Configured" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Error:** CodeQL workflow exists but has no languages configured" >> $GITHUB_STEP_SUMMARY
            echo "**Action Required:** Configure appropriate languages in codeql-analysis.yml" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ùå ERROR: No languages configured in CodeQL workflow"
            exit 1
          fi

          echo "**Configured Languages:** $LANGUAGES" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Validate language presence in repository
          INVALID_LANGS=""
          VALID_LANGS=""

          for LANG in $LANGUAGES; do
            case "$LANG" in
              python)
                # Check for Python files (should be none in v04.00.00)
                if find . -name "*.py" -type f ! -path "./.git/*" | grep -q .; then
                  VALID_LANGS="$VALID_LANGS python"
                  echo "‚úÖ Python: Found Python files" >> $GITHUB_STEP_SUMMARY
                else
                  INVALID_LANGS="$INVALID_LANGS python"
                  echo "‚ùå Python: No Python files found (PHP-only repository)" >> $GITHUB_STEP_SUMMARY
                fi
                ;;
              javascript|typescript)
                # Check for JS/TS files
                if find . \( -name "*.js" -o -name "*.ts" -o -name "*.json" \) -type f ! -path "./.git/*" ! -path "./node_modules/*" | grep -q .; then
                  VALID_LANGS="$VALID_LANGS $LANG"
                  echo "‚úÖ $LANG: Found JavaScript/TypeScript/JSON files" >> $GITHUB_STEP_SUMMARY
                else
                  INVALID_LANGS="$INVALID_LANGS $LANG"
                  echo "‚ö†Ô∏è $LANG: No JavaScript/TypeScript files found" >> $GITHUB_STEP_SUMMARY
                fi
                ;;
              java)
                if find . -name "*.java" -type f ! -path "./.git/*" | grep -q .; then
                  VALID_LANGS="$VALID_LANGS java"
                  echo "‚úÖ Java: Found Java files" >> $GITHUB_STEP_SUMMARY
                else
                  INVALID_LANGS="$INVALID_LANGS java"
                  echo "‚ö†Ô∏è Java: No Java files found" >> $GITHUB_STEP_SUMMARY
                fi
                ;;
              go)
                if find . -name "*.go" -type f ! -path "./.git/*" | grep -q .; then
                  VALID_LANGS="$VALID_LANGS go"
                  echo "‚úÖ Go: Found Go files" >> $GITHUB_STEP_SUMMARY
                else
                  INVALID_LANGS="$INVALID_LANGS go"
                  echo "‚ö†Ô∏è Go: No Go files found" >> $GITHUB_STEP_SUMMARY
                fi
                ;;
              cpp|c)
                if find . \( -name "*.cpp" -o -name "*.c" -o -name "*.h" \) -type f ! -path "./.git/*" | grep -q .; then
                  VALID_LANGS="$VALID_LANGS $LANG"
                  echo "‚úÖ $LANG: Found C/C++ files" >> $GITHUB_STEP_SUMMARY
                else
                  INVALID_LANGS="$INVALID_LANGS $LANG"
                  echo "‚ö†Ô∏è $LANG: No C/C++ files found" >> $GITHUB_STEP_SUMMARY
                fi
                ;;
              ruby)
                if find . -name "*.rb" -type f ! -path "./.git/*" | grep -q .; then
                  VALID_LANGS="$VALID_LANGS ruby"
                  echo "‚úÖ Ruby: Found Ruby files" >> $GITHUB_STEP_SUMMARY
                else
                  INVALID_LANGS="$INVALID_LANGS ruby"
                  echo "‚ö†Ô∏è Ruby: No Ruby files found" >> $GITHUB_STEP_SUMMARY
                fi
                ;;
              *)
                echo "‚ö†Ô∏è $LANG: Unknown language, skipping validation" >> $GITHUB_STEP_SUMMARY
                ;;
            esac
          done

          echo "" >> $GITHUB_STEP_SUMMARY

          # Report results
          if [ -n "$INVALID_LANGS" ]; then
            echo "**‚ö†Ô∏è Warning:** Some configured languages may not have corresponding files:" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "Invalid languages: $INVALID_LANGS" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Note:** This is informational. CodeQL will skip languages without source files." >> $GITHUB_STEP_SUMMARY
            echo "For PHP repository (v04.00.00), JavaScript language covers JSON/YAML/shell scripts." >> $GITHUB_STEP_SUMMARY
          else
            echo "‚úÖ **All configured CodeQL languages have corresponding source files**" >> $GITHUB_STEP_SUMMARY
          fi

          # Always succeed - this is informational only
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ‚úÖ CodeQL Configuration Validation Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Status:** CodeQL language configuration reviewed successfully" >> $GITHUB_STEP_SUMMARY
          echo ""
          echo "‚úÖ SUCCESS: CodeQL validation complete"
          exit 0

  summary:
    name: Compliance Summary
    runs-on: ubuntu-latest
    needs: [repository-structure, documentation-quality, coding-standards, license-compliance, git-hygiene, workflow-validation]
    if: always()

    steps:
      - name: Generate Compliance Report
        run: |
          set -x
          echo "# üìä MokoStandards Compliance Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Calculate overall status
          REPO_STATUS="${{ needs.repository-structure.result }}"
          DOCS_STATUS="${{ needs.documentation-quality.result }}"
          CODE_STATUS="${{ needs.coding-standards.result }}"
          LICENSE_STATUS="${{ needs.license-compliance.result }}"
          GIT_STATUS="${{ needs.git-hygiene.result }}"
          WORKFLOW_STATUS="${{ needs.workflow-validation.result }}"

          PASSED=0
          FAILED=0
          TOTAL=6

          [ "$REPO_STATUS" = "success" ] && PASSED=$((PASSED + 1)) || FAILED=$((FAILED + 1))
          [ "$DOCS_STATUS" = "success" ] && PASSED=$((PASSED + 1)) || FAILED=$((FAILED + 1))
          [ "$CODE_STATUS" = "success" ] && PASSED=$((PASSED + 1)) || FAILED=$((FAILED + 1))
          [ "$LICENSE_STATUS" = "success" ] && PASSED=$((PASSED + 1)) || FAILED=$((FAILED + 1))
          [ "$GIT_STATUS" = "success" ] && PASSED=$((PASSED + 1)) || FAILED=$((FAILED + 1))
          [ "$WORKFLOW_STATUS" = "success" ] && PASSED=$((PASSED + 1)) || FAILED=$((FAILED + 1))

          COMPLIANCE_PERCENT=$((PASSED * 100 / TOTAL))

          # Overall status badge
          if [ "$COMPLIANCE_PERCENT" -eq 100 ]; then
            echo "## ‚úÖ Overall Status: **COMPLIANT** ($COMPLIANCE_PERCENT%)" >> $GITHUB_STEP_SUMMARY
          elif [ "$COMPLIANCE_PERCENT" -ge 80 ]; then
            echo "## ‚ö†Ô∏è Overall Status: **MOSTLY COMPLIANT** ($COMPLIANCE_PERCENT%)" >> $GITHUB_STEP_SUMMARY
          elif [ "$COMPLIANCE_PERCENT" -ge 50 ]; then
            echo "## ‚ö†Ô∏è Overall Status: **PARTIALLY COMPLIANT** ($COMPLIANCE_PERCENT%)" >> $GITHUB_STEP_SUMMARY
          else
            echo "## ‚ùå Overall Status: **NON-COMPLIANT** ($COMPLIANCE_PERCENT%)" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Score:** $PASSED/$TOTAL validation areas passed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Progress bar
          FILLED=$((COMPLIANCE_PERCENT / 5))
          EMPTY=$((20 - FILLED))
          BAR=""
          for i in $(seq 1 $FILLED); do BAR="${BAR}‚ñà"; done
          for i in $(seq 1 $EMPTY); do BAR="${BAR}‚ñë"; done
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "$BAR $COMPLIANCE_PERCENT%" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Detailed breakdown
          echo "## Validation Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Area | Status | Result | Priority |" >> $GITHUB_STEP_SUMMARY
          echo "|------|--------|--------|----------|" >> $GITHUB_STEP_SUMMARY

          # Repository Structure
          if [ "$REPO_STATUS" = "success" ]; then
            echo "| üìÅ Repository Structure | ‚úÖ Pass | Compliant | - |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| üìÅ Repository Structure | ‚ùå Fail | **Action Required** | üî¥ Critical |" >> $GITHUB_STEP_SUMMARY
          fi

          # Documentation Quality
          if [ "$DOCS_STATUS" = "success" ]; then
            echo "| üìö Documentation Quality | ‚úÖ Pass | Compliant | - |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| üìö Documentation Quality | ‚ùå Fail | **Action Required** | üî¥ Critical |" >> $GITHUB_STEP_SUMMARY
          fi

          # Coding Standards
          if [ "$CODE_STATUS" = "success" ]; then
            echo "| üíª Coding Standards | ‚úÖ Pass | Compliant | - |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| üíª Coding Standards | ‚ö†Ô∏è Warning | Review Recommended | üü° Medium |" >> $GITHUB_STEP_SUMMARY
          fi

          # License Compliance
          if [ "$LICENSE_STATUS" = "success" ]; then
            echo "| ‚öñÔ∏è License Compliance | ‚úÖ Pass | Compliant | - |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ‚öñÔ∏è License Compliance | ‚ùå Fail | **Action Required** | üî¥ Critical |" >> $GITHUB_STEP_SUMMARY
          fi

          # Git Hygiene
          if [ "$GIT_STATUS" = "success" ]; then
            echo "| üßπ Git Repository Hygiene | ‚úÖ Pass | Compliant | - |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| üßπ Git Repository Hygiene | ‚ö†Ô∏è Warning | Review Recommended | üü° Medium |" >> $GITHUB_STEP_SUMMARY
          fi

          # Workflow Configuration
          if [ "$WORKFLOW_STATUS" = "success" ]; then
            echo "| ‚öôÔ∏è Workflow Configuration | ‚úÖ Pass | Compliant | - |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ‚öôÔ∏è Workflow Configuration | ‚ö†Ô∏è Warning | Review Recommended | üü° Medium |" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY

          # Action items summary
          if [ "$FAILED" -gt 0 ]; then
            echo "## ‚ö° Action Items" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**$FAILED validation area(s) require attention:**" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY

            [ "$REPO_STATUS" != "success" ] && echo "- üî¥ **Critical:** Fix repository structure issues" >> $GITHUB_STEP_SUMMARY
            [ "$DOCS_STATUS" != "success" ] && echo "- üî¥ **Critical:** Improve documentation quality" >> $GITHUB_STEP_SUMMARY
            [ "$LICENSE_STATUS" != "success" ] && echo "- üî¥ **Critical:** Resolve license compliance issues" >> $GITHUB_STEP_SUMMARY
            [ "$CODE_STATUS" != "success" ] && echo "- üü° **Medium:** Review coding standards violations" >> $GITHUB_STEP_SUMMARY
            [ "$GIT_STATUS" != "success" ] && echo "- üü° **Medium:** Address git repository hygiene items" >> $GITHUB_STEP_SUMMARY
            [ "$WORKFLOW_STATUS" != "success" ] && echo "- üü° **Medium:** Review workflow configuration" >> $GITHUB_STEP_SUMMARY

            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Next Steps:**" >> $GITHUB_STEP_SUMMARY
            echo "1. Review detailed results in individual job outputs above" >> $GITHUB_STEP_SUMMARY
            echo "2. Follow remediation steps provided for each failure" >> $GITHUB_STEP_SUMMARY
            echo "3. Re-run this workflow after making corrections" >> $GITHUB_STEP_SUMMARY
            echo "4. Reach 100% compliance before merging" >> $GITHUB_STEP_SUMMARY
          else
            echo "## üéâ Excellent!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Your repository is **fully compliant** with MokoStandards!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Achievements:**" >> $GITHUB_STEP_SUMMARY
            echo "- ‚úÖ All required directories and files present" >> $GITHUB_STEP_SUMMARY
            echo "- ‚úÖ Documentation meets quality standards" >> $GITHUB_STEP_SUMMARY
            echo "- ‚úÖ Coding standards followed" >> $GITHUB_STEP_SUMMARY
            echo "- ‚úÖ License compliance verified" >> $GITHUB_STEP_SUMMARY
            echo "- ‚úÖ Git repository well-maintained" >> $GITHUB_STEP_SUMMARY
            echo "- ‚úÖ Workflows properly configured" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "üìö **Resources:**" >> $GITHUB_STEP_SUMMARY
          echo "- [MokoStandards Documentation](https://github.com/mokoconsulting-tech/MokoStandards)" >> $GITHUB_STEP_SUMMARY
          echo "- [Repository Structure Guide](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/docs/policy/core-structure.md)" >> $GITHUB_STEP_SUMMARY
          echo "- [Documentation Standards](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/docs/policy/document-formatting.md)" >> $GITHUB_STEP_SUMMARY
          echo "- [Coding Standards](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/docs/policy/coding-style-guide.md)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "_Generated by MokoStandards Compliance Workflow v${WORKFLOW_VERSION}_" >> $GITHUB_STEP_SUMMARY

          # Create tracking issue for non-compliance if on push
          if [ "$COMPLIANCE_PERCENT" -lt 100 ] && [ "${{ github.event_name }}" = "push" ]; then
            echo "Creating tracking issue for standards violations..."
          fi

          # Exit with error if not fully compliant
          if [ "$COMPLIANCE_PERCENT" -lt 100 ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ‚ùå Standards Compliance Failed" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Overall Compliance:** $COMPLIANCE_PERCENT%" >> $GITHUB_STEP_SUMMARY
            echo "**Status:** Repository does not meet 100% compliance requirement" >> $GITHUB_STEP_SUMMARY
            echo "**Action Required:** Review and fix all validation failures above" >> $GITHUB_STEP_SUMMARY
            echo ""
            echo "‚ùå ERROR: Standards compliance at $COMPLIANCE_PERCENT% - 100% required"
            exit 1
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ‚úÖ Full Standards Compliance Achieved" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Overall Compliance:** 100%" >> $GITHUB_STEP_SUMMARY
          echo "**Status:** Repository meets all MokoStandards requirements" >> $GITHUB_STEP_SUMMARY
          echo ""
          echo "‚úÖ SUCCESS: Repository is fully MokoStandards compliant"

      - name: Create tracking issue for standards violations
        if: failure() && github.event_name == 'push'
        uses: actions/github-script@v6
        with:
          script: |
            const compliancePercent = '${{ needs.compliance-check.outputs.compliance_percentage }}' || '0';
            const failedChecks = [];

            // Collect failed checks from job outputs
            const jobs = [
              { name: 'File Headers', failed: '${{ needs.compliance-check.outputs.headers_ok }}' !== 'true' },
              { name: 'Required Files', failed: '${{ needs.compliance-check.outputs.required_files_ok }}' !== 'true' },
              { name: 'Documentation', failed: '${{ needs.compliance-check.outputs.documentation_ok }}' !== 'true' },
              { name: 'Code Quality', failed: '${{ needs.compliance-check.outputs.code_quality_ok }}' !== 'true' }
            ];

            jobs.forEach(job => {
              if (job.failed) failedChecks.push(job.name);
            });

            const body = `## üìã Standards Compliance Violations Detected

            **Branch**: \`${context.ref}\`
            **Commit**: ${context.sha.substring(0, 7)}
            **Triggered by**: @${context.actor}
            **Date**: ${new Date().toISOString()}

            ### Compliance Score: ${compliancePercent}%

            ### ‚ùå Failed Checks
            ${failedChecks.length > 0 ? failedChecks.map(check => `- ${check}`).join('\n') : '_Details available in workflow run_'}

            ### üìä What This Means
            Your repository does not meet the required MokoStandards compliance threshold. This can affect:
            - Code quality and maintainability
            - Team collaboration efficiency
            - Automated tooling integration
            - Repository discoverability

            ### ‚úÖ Required Actions
            1. Review the [workflow run](${context.payload.repository.html_url}/actions/runs/${context.runId}) for detailed findings
            2. Address each failed check according to MokoStandards documentation
            3. Push changes to trigger a new compliance scan
            4. Ensure compliance reaches 100% before merging

            ### üìö Resources
            - [MokoStandards Documentation](https://github.com/mokoconsulting-tech/MokoStandards)
            - [Repository Structure Guide](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/docs/policy/core-structure.md)
            - [Documentation Standards](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/docs/policy/document-formatting.md)
            - [Coding Standards](https://github.com/mokoconsulting-tech/MokoStandards/tree/main/docs/policy/coding-style-guide.md)

            ### üîÑ Resolution
            This issue will be automatically closed when compliance reaches 100%.

            ---
            *This issue was automatically created by the Standards Compliance workflow.*
            `;

            // Check for existing open issue
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              labels: 'standards-violation',
              per_page: 1
            });

            if (issues.data.length > 0) {
              // Update existing issue
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issues.data[0].number,
                body: `### üîÑ Updated Scan Results\n\n${body}`
              });
              console.log(`Updated existing issue #${issues.data[0].number}`);
            } else {
              // Create new issue
              const issue = await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `[Standards] Compliance Violations - ${new Date().toISOString().split('T')[0]}`,
                body: body,
                labels: ['standards-violation', 'compliance', 'automation'],
                assignees: ['copilot', 'jmiller-moko']
              });
              console.log(`Created new issue #${issue.data.number}`);
            }

# CUSTOMIZATION:
#
# 1. Adjust severity of checks (convert warnings to errors or vice versa)
# 2. Add project-specific validation rules
# 3. Integrate with custom linting tools
# 4. Add notification steps for compliance failures
# 5. Customize required files/directories for your project type
