<!--
SPDX-License-Identifier: GPL-3.0-or-later
Copyright (C) 2026 Moko Consulting LLC

This file is part of MokoStandards.
For full license text, see LICENSE file in repository root.
-->

# Logs Directory

## Metadata

| Field | Value |
|-------|-------|
| **Document Type** | Guide |
| **Domain** | Development |
| **Applies To** | All Scripts |
| **Owner** | Development Team |
| **Repo** | MokoStandards |
| **Path** | logs/README.md |
| **VERSION | 03.01.03 |
| **Status** | Active |
| **Last Reviewed** | 2026-02-09 |
| **Reviewed By** | Development Team |

---

## Purpose

This directory stores log files generated by:
- Automation scripts (Python, Shell, PowerShell)
- GitHub Copilot agent runs
- CI/CD workflow runs (when run locally)
- Validation and maintenance scripts
- Build and release scripts

## Directory Structure

```
logs/
├── README.md              # This file
├── automation/            # Logs from automation scripts
├── validation/            # Logs from validation scripts
├── release/               # Logs from release scripts
├── copilot/              # Logs from GitHub Copilot agent runs
└── maintenance/          # Logs from maintenance scripts
```

## Logging Standards

### File Naming Convention

Log files should follow this naming pattern:
```
{script-name}_{timestamp}.log
```

Examples:
- `bulk_update_repos_20260209_075300.log`
- `validate_structure_20260209_080000.log`
- `copilot_run_20260209_081500.log`

### Timestamp Format

Use ISO 8601 format for timestamps in filenames:
- `YYYYMMDD_HHMMSS` (e.g., `20260209_075300`)
- Or `YYYY-MM-DD_HH-MM-SS` (e.g., `2026-02-09_07-53-00`)

### Log File Format

Log entries should include:
1. **Timestamp** - When the event occurred
2. **Level** - DEBUG, INFO, WARNING, ERROR, CRITICAL
3. **Source** - Script name or module
4. **Message** - Detailed description

Example log format:
```
2026-02-09 07:53:00.123 | INFO | bulk_update_repos.py | Starting bulk repository update
2026-02-09 07:53:01.456 | INFO | bulk_update_repos.py | Processing repository: MokoStandards
2026-02-09 07:53:02.789 | WARNING | bulk_update_repos.py | Repository has uncommitted changes
2026-02-09 07:53:03.012 | ERROR | bulk_update_repos.py | Failed to sync file: permission denied
```

## Python Logging Configuration

### Basic Configuration

```python
import logging
from pathlib import Path
from datetime import datetime

# Setup logging to file
log_dir = Path(__file__).parent.parent.parent / "logs" / "automation"
log_dir.mkdir(parents=True, exist_ok=True)

timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
log_file = log_dir / f"{Path(__file__).stem}_{timestamp}.log"

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s | %(levelname)s | %(name)s | %(message)s',
    handlers=[
        logging.FileHandler(log_file),
        logging.StreamHandler()  # Also log to console
    ]
)

logger = logging.getLogger(__name__)
```

### Advanced Configuration with Rotation

```python
import logging
from logging.handlers import RotatingFileHandler
from pathlib import Path

def setup_logging(script_name: str, log_level: int = logging.INFO):
    """Setup logging with file rotation."""
    log_dir = Path(__file__).parent.parent.parent / "logs" / "automation"
    log_dir.mkdir(parents=True, exist_ok=True)
    
    log_file = log_dir / f"{script_name}.log"
    
    # Rotate logs when they reach 10MB, keep 5 backups
    handler = RotatingFileHandler(
        log_file,
        maxBytes=10*1024*1024,  # 10MB
        backupCount=5
    )
    
    formatter = logging.Formatter(
        '%(asctime)s | %(levelname)s | %(name)s | %(message)s'
    )
    handler.setFormatter(formatter)
    
    logger = logging.getLogger()
    logger.setLevel(log_level)
    logger.addHandler(handler)
    
    # Also log to console
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    logger.addHandler(console_handler)
    
    return logger
```

## Shell Script Logging

### Basic Logging Function

```bash
#!/bin/bash

# Setup logging
LOG_DIR="$(dirname "$0")/../../logs/automation"
mkdir -p "$LOG_DIR"

TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
SCRIPT_NAME=$(basename "$0" .sh)
LOG_FILE="$LOG_DIR/${SCRIPT_NAME}_${TIMESTAMP}.log"

# Logging functions
log_info() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') | INFO | $SCRIPT_NAME | $*" | tee -a "$LOG_FILE"
}

log_error() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') | ERROR | $SCRIPT_NAME | $*" | tee -a "$LOG_FILE" >&2
}

log_warning() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') | WARNING | $SCRIPT_NAME | $*" | tee -a "$LOG_FILE"
}

# Usage
log_info "Script started"
log_warning "This is a warning"
log_error "This is an error"
```

## GitHub Copilot Agent Logging

For GitHub Copilot agent runs, logs should be stored in `logs/copilot/` with:
- Session ID in filename
- Start and end timestamps
- Actions performed
- Files modified
- Any errors or warnings

Example filename:
```
copilot_session_a1b2c3d4_20260209_075300.log
```

## Log Retention

### Automated Cleanup

Scripts should implement log rotation or cleanup to prevent unbounded growth:

- **Keep recent logs**: Last 30 days
- **Archive old logs**: Compress logs older than 30 days
- **Delete ancient logs**: Remove compressed logs older than 90 days

### Manual Cleanup

To manually clean up old logs:

```bash
# Remove logs older than 30 days
find logs/ -name "*.log" -type f -mtime +30 -delete

# Compress logs older than 7 days
find logs/ -name "*.log" -type f -mtime +7 -exec gzip {} \;

# Remove compressed logs older than 90 days
find logs/ -name "*.log.gz" -type f -mtime +90 -delete
```

## Security Considerations

### Sensitive Data

**Never log sensitive information:**
- Passwords or API tokens
- Private keys or certificates
- Personal identifiable information (PII)
- Confidential business data

### Log Sanitization

If sensitive data might be logged, sanitize it:

```python
import re

def sanitize_log_message(message: str) -> str:
    """Remove sensitive data from log messages."""
    # Replace tokens
    message = re.sub(r'ghp_[a-zA-Z0-9]{36}', 'ghp_***REDACTED***', message)
    message = re.sub(r'gho_[a-zA-Z0-9]{36}', 'gho_***REDACTED***', message)
    
    # Replace API keys
    message = re.sub(r'AKIA[0-9A-Z]{16}', 'AKIA***REDACTED***', message)
    
    # Replace passwords
    message = re.sub(r'password[=:]\s*\S+', 'password=***REDACTED***', message, flags=re.IGNORECASE)
    
    return message
```

## Troubleshooting

### Permission Errors

If you encounter permission errors when writing logs:

```bash
# Ensure the logs directory is writable
chmod -R u+w logs/

# Check directory ownership
ls -la logs/
```

### Disk Space

Monitor disk space to prevent logs from filling up storage:

```bash
# Check logs directory size
du -sh logs/

# Find largest log files
find logs/ -type f -exec ls -lh {} \; | sort -k 5 -h -r | head -10
```

## Integration with CI/CD

### GitHub Actions

In GitHub Actions workflows, logs are automatically captured. For local log storage:

```yaml
- name: Run script with logging
  run: |
    mkdir -p logs/automation
    python3 scripts/automation/bulk_update_repos.py --dry-run 2>&1 | tee logs/automation/bulk_update_$(date +%Y%m%d_%H%M%S).log

- name: Upload logs as artifacts
  if: always()
  uses: actions/upload-artifact@v3
  with:
    name: script-logs
    path: logs/
    retention-days: 30
```

## Best Practices

1. **Always log important events**: Start, completion, errors
2. **Use appropriate log levels**: DEBUG for detailed info, INFO for general events, WARNING for potential issues, ERROR for failures
3. **Include context**: User, repository, operation being performed
4. **Timestamp everything**: Use consistent timestamp format
5. **Rotate logs**: Implement log rotation to manage disk space
6. **Test logging**: Verify logs are written correctly
7. **Document log formats**: Explain what each log entry means
8. **Sanitize sensitive data**: Never log secrets or PII

## Related Documentation

- [Scripts README](../scripts/README.md)
- [Copilot Usage Guide](../docs/guide/copilot-usage-guide.md)
- [Validation Framework](../scripts/lib/validation_framework.py)
- [Common Library](../scripts/lib/common.py)

## Support

For questions or issues with logging:
1. Check this documentation
2. Review existing script implementations
3. Contact the development team
4. File an issue on GitHub

---

**Last Updated**: 2026-02-09  
**Maintained By**: Development Team  
**Version**: 03.01.03
